<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BalanCoffee - Test Suite Hub</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            font-size: 1.2em;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .test-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        
        .test-card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            position: relative;
        }
        
        .test-card-header .icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }
        
        .test-card-header h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .test-card-header p {
            opacity: 0.9;
            font-size: 0.95em;
        }
        
        .test-card-body {
            padding: 25px;
        }
        
        .test-features {
            list-style: none;
            margin-bottom: 25px;
        }
        
        .test-features li {
            padding: 8px 0;
            color: #666;
            font-size: 0.9em;
            display: flex;
            align-items: center;
        }
        
        .test-features li:before {
            content: "‚úì";
            color: #28a745;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .test-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            flex: 1;
            justify-content: center;
            font-size: 0.9em;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        
        .quick-actions {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .quick-actions h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .quick-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .app-status {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .status-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        
        .status-icon {
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
        }
        
        .status-label {
            font-weight: bold;
            color: #495057;
        }
        
        .status-value {
            font-size: 1.2em;
            color: #007bff;
            margin-top: 5px;
        }
        
        .test-logs {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 25px;
            margin-top: 30px;
        }
        
        .logs-container {
            background: #1e1e1e;
            color: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 3px 0;
            padding: 2px 0;
        }
        
        .log-info { color: #74c0fc; }
        .log-success { color: #51cf66; }
        .log-warning { color: #ffd43b; }
        .log-error { color: #ff6b6b; }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .test-grid { grid-template-columns: 1fr; }
            .quick-buttons { flex-direction: column; }
            .btn { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üß™ BalanCoffee Test Suite Hub</h1>
            <p>Trung t√¢m ki·ªÉm th·ª≠ to√†n di·ªán cho ·ª©ng d·ª•ng BalanCoffee</p>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3>üöÄ H√†nh ƒë·ªông nhanh</h3>
            <div class="quick-buttons">
                <a href="index.html" class="btn btn-primary" target="_blank">
                    üì± M·ªü ·ª©ng d·ª•ng ch√≠nh
                </a>
                <button class="btn btn-success" onclick="runQuickTestSuite()">
                    ‚ö° Ki·ªÉm th·ª≠ nhanh
                </button>
                <button class="btn btn-warning" onclick="runFullTestSuite()">
                    üîß Ki·ªÉm th·ª≠ ƒë·∫ßy ƒë·ªß
                </button>
                <button class="btn btn-danger" onclick="runStressTests()">
                    üí™ Ki·ªÉm th·ª≠ √°p l·ª±c
                </button>
                <button class="btn btn-secondary" onclick="clearAllLogs()">
                    üóëÔ∏è X√≥a logs
                </button>
            </div>
        </div>

        <!-- Test Cards -->
        <div class="test-grid">
            <!-- Complete Test Suite -->
            <div class="test-card">
                <div class="test-card-header">
                    <span class="icon">üß™</span>
                    <h3>Complete Test Suite</h3>
                    <p>H·ªá th·ªëng ki·ªÉm th·ª≠ to√†n di·ªán v·ªõi t·∫•t c·∫£ c√°c lo·∫°i test</p>
                </div>
                <div class="test-card-body">
                    <ul class="test-features">
                        <li>DOM & UI Testing</li>
                        <li>Function Testing</li>
                        <li>Data Management Testing</li>
                        <li>Integration Testing</li>
                        <li>Performance Testing</li>
                        <li>Security Testing</li>
                    </ul>
                    <div class="test-actions">
                        <a href="complete-test-suite.html" class="btn btn-primary" target="_blank">
                            üöÄ Ch·∫°y
                        </a>
                        <a href="complete-test-suite.html" class="btn btn-secondary" target="_blank">
                            üìñ Xem
                        </a>
                    </div>
                </div>
            </div>

            <!-- Unit Tests -->
            <div class="test-card">
                <div class="test-card-header">
                    <span class="icon">‚öôÔ∏è</span>
                    <h3>Unit Tests</h3>
                    <p>Ki·ªÉm th·ª≠ t·ª´ng ch·ª©c nƒÉng v√† module ri√™ng l·∫ª</p>
                </div>
                <div class="test-card-body">
                    <ul class="test-features">
                        <li>Utility Functions</li>
                        <li>Data Management</li>
                        <li>UI Functions</li>
                        <li>Integration Tests</li>
                        <li>Test Framework t√πy ch·ªânh</li>
                        <li>Detailed Assertions</li>
                    </ul>
                    <div class="test-actions">
                        <a href="unit-tests.html" class="btn btn-success" target="_blank">
                            üß™ Ch·∫°y
                        </a>
                        <a href="unit-tests.html" class="btn btn-secondary" target="_blank">
                            üìñ Xem
                        </a>
                    </div>
                </div>
            </div>

            <!-- E2E Tests -->
            <div class="test-card">
                <div class="test-card-header">
                    <span class="icon">ü§ñ</span>
                    <h3>E2E Tests</h3>
                    <p>Ki·ªÉm th·ª≠ t·ª± ƒë·ªông t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi (End-to-End)</p>
                </div>
                <div class="test-card-body">
                    <ul class="test-features">
                        <li>App Loading & UI</li>
                        <li>Menu Navigation</li>
                        <li>Order Creation Flow</li>
                        <li>Payment Flow</li>
                        <li>Admin Management</li>
                        <li>Error Handling</li>
                    </ul>
                    <div class="test-actions">
                        <a href="e2e-tests.html" class="btn btn-warning" target="_blank">
                            ü§ñ Ch·∫°y
                        </a>
                        <a href="e2e-tests.html" class="btn btn-secondary" target="_blank">
                            üìñ Xem
                        </a>
                    </div>
                </div>
            </div>

            <!-- Performance Tests -->
            <div class="test-card">
                <div class="test-card-header">
                    <span class="icon">‚ö°</span>
                    <h3>Performance Tests</h3>
                    <p>Ki·ªÉm th·ª≠ hi·ªáu su·∫•t v√† kh·∫£ nƒÉng ch·ªãu t·∫£i</p>
                </div>
                <div class="test-card-body">
                    <ul class="test-features">
                        <li>App Load Time</li>
                        <li>DOM Query Speed</li>
                        <li>Memory Usage</li>
                        <li>Render Performance</li>
                        <li>Storage Speed</li>
                        <li>Load & Stress Testing</li>
                    </ul>
                    <div class="test-actions">
                        <a href="performance-tests.html" class="btn btn-danger" target="_blank">
                            ‚ö° Ch·∫°y
                        </a>
                        <a href="performance-tests.html" class="btn btn-secondary" target="_blank">
                            üìñ Xem
                        </a>
                    </div>
                </div>
            </div>

            <!-- Debug Tools -->
            <div class="test-card">
                <div class="test-card-header">
                    <span class="icon">üîç</span>
                    <h3>Debug Tools</h3>
                    <p>C√¥ng c·ª• debug v√† ch·∫©n ƒëo√°n l·ªói</p>
                </div>
                <div class="test-card-body">
                    <ul class="test-features">
                        <li>DOM Structure Analysis</li>
                        <li>Function Availability Check</li>
                        <li>Error Capture</li>
                        <li>Real-time Monitoring</li>
                        <li>Script Loading Debug</li>
                        <li>Element Finding Tools</li>
                    </ul>
                    <div class="test-actions">
                        <a href="dom-debug.html" class="btn btn-secondary" target="_blank">
                            üîç Debug
                        </a>
                        <a href="error-capture-debug.html" class="btn btn-secondary" target="_blank">
                            üìù Errors
                        </a>
                    </div>
                </div>
            </div>

            <!-- Legacy Tests -->
            <div class="test-card">
                <div class="test-card-header">
                    <span class="icon">üìã</span>
                    <h3>Legacy Tests</h3>
                    <p>C√°c test c≈© v√† c√¥ng c·ª• validation</p>
                </div>
                <div class="test-card-body">
                    <ul class="test-features">
                        <li>Final Test Page</li>
                        <li>Quick Debug Tools</li>
                        <li>Validate All Functions</li>
                        <li>Test Fixes</li>
                        <li>Script Loading Tests</li>
                        <li>Element Validation</li>
                    </ul>
                    <div class="test-actions">
                        <a href="final-test.html" class="btn btn-secondary" target="_blank">
                            üìã Final
                        </a>
                        <a href="validate-all.html" class="btn btn-secondary" target="_blank">
                            ‚úÖ Validate
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- App Status -->
        <div class="app-status">
            <h3>üìä Tr·∫°ng th√°i ·ª©ng d·ª•ng</h3>
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-icon">üèóÔ∏è</span>
                    <div class="status-label">DOM Elements</div>
                    <div class="status-value" id="dom-status">Checking...</div>
                </div>
                <div class="status-item">
                    <span class="status-icon">‚öôÔ∏è</span>
                    <div class="status-label">Functions</div>
                    <div class="status-value" id="functions-status">Checking...</div>
                </div>
                <div class="status-item">
                    <span class="status-icon">üíæ</span>
                    <div class="status-label">Data</div>
                    <div class="status-value" id="data-status">Checking...</div>
                </div>
                <div class="status-item">
                    <span class="status-icon">üß†</span>
                    <div class="status-label">Memory</div>
                    <div class="status-value" id="memory-status">Checking...</div>
                </div>
                <div class="status-item">
                    <span class="status-icon">‚ö°</span>
                    <div class="status-label">Performance</div>
                    <div class="status-value" id="performance-status">Checking...</div>
                </div>
                <div class="status-item">
                    <span class="status-icon">üîê</span>
                    <div class="status-label">Security</div>
                    <div class="status-value" id="security-status">Checking...</div>
                </div>
            </div>
        </div>

        <!-- Test Logs -->
        <div class="test-logs">
            <h3>üìù Test Logs</h3>
            <div class="logs-container" id="test-logs">
                <!-- Logs will be populated here -->
            </div>
        </div>
    </div>

    <!-- Include app scripts for testing -->
    <script src="data.js"></script>
    <script src="script.js"></script>

    <script>
        class TestSuiteHub {
            constructor() {
                this.logs = [];
                this.statusChecks = {
                    dom: false,
                    functions: false,
                    data: false,
                    memory: false,
                    performance: false,
                    security: false
                };
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = { timestamp, message, type };
                this.logs.push(logEntry);
                
                const logsContainer = document.getElementById('test-logs');
                if (logsContainer) {
                    const logDiv = document.createElement('div');
                    logDiv.className = `log-entry log-${type}`;
                    logDiv.textContent = `[${timestamp}] ${message}`;
                    logsContainer.appendChild(logDiv);
                    logsContainer.scrollTop = logsContainer.scrollHeight;
                }
                
                console.log(`[HUB-${type.toUpperCase()}] ${message}`);
            }

            updateStatus(category, status, details = '') {
                const statusElement = document.getElementById(`${category}-status`);
                if (statusElement) {
                    statusElement.textContent = status;
                    statusElement.style.color = this.getStatusColor(status);
                }
                
                this.statusChecks[category] = status.includes('OK') || status.includes('‚úÖ');
                this.log(`${category} status: ${status} ${details}`, this.getLogType(status));
            }

            getStatusColor(status) {
                if (status.includes('‚úÖ') || status.includes('OK')) return '#28a745';
                if (status.includes('‚ö†Ô∏è') || status.includes('Warning')) return '#ffc107';
                if (status.includes('‚ùå') || status.includes('Error')) return '#dc3545';
                return '#007bff';
            }

            getLogType(status) {
                if (status.includes('‚úÖ') || status.includes('OK')) return 'success';
                if (status.includes('‚ö†Ô∏è') || status.includes('Warning')) return 'warning';
                if (status.includes('‚ùå') || status.includes('Error')) return 'error';
                return 'info';
            }

            async checkDOMStatus() {
                try {
                    const criticalElements = [
                        'menu-grid', 'invoice-list', 'order-items', 'sidebar',
                        'order-modal', 'payment-modal', 'admin-section'
                    ];
                    
                    // Open app in hidden iframe to check
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = 'index.html';
                    document.body.appendChild(iframe);
                    
                    await new Promise(resolve => {
                        iframe.onload = () => {
                            const doc = iframe.contentDocument;
                            const found = criticalElements.filter(id => doc.getElementById(id));
                            const status = `${found.length}/${criticalElements.length} ‚úÖ`;
                            this.updateStatus('dom', status, `Elements found: ${found.join(', ')}`);
                            document.body.removeChild(iframe);
                            resolve();
                        };
                    });
                } catch (error) {
                    this.updateStatus('dom', '‚ùå Error', error.message);
                }
            }

            async checkFunctionsStatus() {
                try {
                    const criticalFunctions = [
                        'renderMenu', 'addToOrder', 'createNewInvoice', 'openOrderModal',
                        'confirmOrder', 'openPaymentModal', 'confirmPayment', 'updateOrderDisplay',
                        'filterMenu', 'toggleAdmin', 'startNewShift', 'endShift'
                    ];
                    
                    const available = criticalFunctions.filter(fn => typeof window[fn] === 'function');
                    const status = `${available.length}/${criticalFunctions.length} ‚úÖ`;
                    this.updateStatus('functions', status, `Available: ${available.join(', ')}`);
                } catch (error) {
                    this.updateStatus('functions', '‚ùå Error', error.message);
                }
            }

            async checkDataStatus() {
                try {
                    const checks = {
                        menuData: window.menuData && Array.isArray(window.menuData) && window.menuData.length > 0,
                        qrPaymentInfo: window.qrPaymentInfo && typeof window.qrPaymentInfo === 'object',
                        localStorage: (() => {
                            try {
                                localStorage.setItem('test', 'test');
                                localStorage.removeItem('test');
                                return true;
                            } catch { return false; }
                        })(),
                        globals: ['currentOrder', 'invoices', 'orderHistory'].every(g => typeof window[g] !== 'undefined')
                    };
                    
                    const passed = Object.values(checks).filter(Boolean).length;
                    const total = Object.keys(checks).length;
                    const status = `${passed}/${total} ‚úÖ`;
                    this.updateStatus('data', status, `Checks: ${Object.keys(checks).filter(k => checks[k]).join(', ')}`);
                } catch (error) {
                    this.updateStatus('data', '‚ùå Error', error.message);
                }
            }

            async checkMemoryStatus() {
                try {
                    if (performance.memory) {
                        const memory = performance.memory;
                        const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
                        const status = usedMB < 50 ? `${usedMB}MB ‚úÖ` : `${usedMB}MB ‚ö†Ô∏è`;
                        this.updateStatus('memory', status, `Used: ${usedMB}MB`);
                    } else {
                        this.updateStatus('memory', 'N/A ‚ö†Ô∏è', 'Memory API not available');
                    }
                } catch (error) {
                    this.updateStatus('memory', '‚ùå Error', error.message);
                }
            }

            async checkPerformanceStatus() {
                try {
                    const start = performance.now();
                    
                    // Simple performance test
                    for (let i = 0; i < 1000; i++) {
                        document.querySelector('body');
                    }
                    
                    const end = performance.now();
                    const duration = Math.round(end - start);
                    const status = duration < 10 ? `${duration}ms ‚úÖ` : `${duration}ms ‚ö†Ô∏è`;
                    this.updateStatus('performance', status, `DOM queries: ${duration}ms`);
                } catch (error) {
                    this.updateStatus('performance', '‚ùå Error', error.message);
                }
            }

            async checkSecurityStatus() {
                try {
                    const checks = {
                        https: window.location.protocol === 'https:' || 
                               window.location.hostname === 'localhost' ||
                               window.location.hostname === '127.0.0.1',
                        xss: !document.body.innerHTML.includes('<script>alert'),
                        localStorage: (() => {
                            try {
                                const malicious = { __proto__: { evil: true } };
                                localStorage.setItem('secTest', JSON.stringify(malicious));
                                const stored = JSON.parse(localStorage.getItem('secTest'));
                                localStorage.removeItem('secTest');
                                return !stored.evil;
                            } catch { return true; }
                        })()
                    };
                    
                    const passed = Object.values(checks).filter(Boolean).length;
                    const total = Object.keys(checks).length;
                    const status = passed === total ? `${passed}/${total} ‚úÖ` : `${passed}/${total} ‚ö†Ô∏è`;
                    this.updateStatus('security', status, `Security checks passed`);
                } catch (error) {
                    this.updateStatus('security', '‚ùå Error', error.message);
                }
            }

            async runAllStatusChecks() {
                this.log('üîç Running all status checks...', 'info');
                
                await Promise.all([
                    this.checkDOMStatus(),
                    this.checkFunctionsStatus(),
                    this.checkDataStatus(),
                    this.checkMemoryStatus(),
                    this.checkPerformanceStatus(),
                    this.checkSecurityStatus()
                ]);
                
                const totalPassed = Object.values(this.statusChecks).filter(Boolean).length;
                const totalChecks = Object.keys(this.statusChecks).length;
                
                this.log(`‚úÖ Status checks completed: ${totalPassed}/${totalChecks} passed`, 
                    totalPassed === totalChecks ? 'success' : 'warning');
            }

            async runQuickTestSuite() {
                this.log('‚ö° Running quick test suite...', 'info');
                
                // Open multiple test windows
                const tests = [
                    { name: 'Unit Tests', url: 'unit-tests.html' },
                    { name: 'DOM Debug', url: 'dom-debug.html' }
                ];
                
                tests.forEach(test => {
                    window.open(test.url, `_blank_${test.name.replace(' ', '_')}`);
                    this.log(`üìÇ Opened ${test.name}`, 'info');
                });
                
                this.log('‚ö° Quick test suite launched', 'success');
            }

            async runFullTestSuite() {
                this.log('üîß Running full test suite...', 'info');
                
                // Open all test windows
                const tests = [
                    { name: 'Complete Suite', url: 'complete-test-suite.html' },
                    { name: 'Unit Tests', url: 'unit-tests.html' },
                    { name: 'E2E Tests', url: 'e2e-tests.html' },
                    { name: 'Performance Tests', url: 'performance-tests.html' }
                ];
                
                tests.forEach(test => {
                    window.open(test.url, `_blank_${test.name.replace(' ', '_')}`);
                    this.log(`üìÇ Opened ${test.name}`, 'info');
                });
                
                this.log('üîß Full test suite launched', 'success');
            }

            async runStressTests() {
                this.log('üí™ Running stress tests...', 'info');
                
                // Open stress testing tools
                const stressTests = [
                    { name: 'Performance Tests', url: 'performance-tests.html' },
                    { name: 'E2E Stress', url: 'e2e-tests.html' }
                ];
                
                stressTests.forEach(test => {
                    window.open(test.url, `_blank_stress_${test.name.replace(' ', '_')}`);
                    this.log(`üí™ Opened ${test.name} for stress testing`, 'info');
                });
                
                this.log('üí™ Stress tests launched', 'success');
            }

            clearAllLogs() {
                this.logs = [];
                const logsContainer = document.getElementById('test-logs');
                if (logsContainer) {
                    logsContainer.innerHTML = '';
                }
                this.log('üóëÔ∏è All logs cleared', 'info');
            }
        }

        // Global test hub instance
        const testHub = new TestSuiteHub();

        // Global functions for buttons
        function runQuickTestSuite() { testHub.runQuickTestSuite(); }
        function runFullTestSuite() { testHub.runFullTestSuite(); }
        function runStressTests() { testHub.runStressTests(); }
        function clearAllLogs() { testHub.clearAllLogs(); }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            testHub.log('üß™ Test Suite Hub initialized', 'success');
            
            // Wait a bit for scripts to load, then run status checks
            setTimeout(async () => {
                await testHub.runAllStatusChecks();
            }, 1000);
        });
    </script>
</body>
</html>
